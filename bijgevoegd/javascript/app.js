document.addEventListener("DOMContentLoaded",()=>{const e=["Actie","Comedie","Drama","Sci-Fi","Horror","Thriller","Romance","Fantasy","Animatie","Documentaires","Crime","Mystery"],t=["Netflix","Disney+","Prime Video","HBO Max","Hulu","Apple TV+"];let n=[],s=[],i=[];const r=document.getElementById("genre-tags"),o=document.getElementById("service-tags"),a=document.getElementById("liked-movie-input"),l=document.getElementById("add-liked-movie-btn"),d=document.getElementById("liked-movies-list"),c=document.getElementById("suggest-btn"),g=document.getElementById("suggestions-container"),p=document.getElementById("placeholder"),m=document.getElementById("loading");function u(){d.innerHTML="",s.forEach(e=>{const t=document.createElement("div");t.className="bg-gray-600 text-white px-3 py-1 rounded-full flex items-center gap-2 text-sm",t.innerHTML=`\n                        <span>${e}</span>\n                        <button data-movie="${e}" class="remove-liked-movie-btn text-gray-400 hover:text-white">&times;</button>\n                    `,d.appendChild(t)}),document.querySelectorAll(".remove-liked-movie-btn").forEach(e=>{e.addEventListener("click",e=>{return t=e.target.dataset.movie,s=s.filter(e=>e!==t),void u();var t})})}function y(){const e=a.value.trim();e&&!s.includes(e)&&(s.push(e),u(),a.value="")}l.addEventListener("click",y),a.addEventListener("keypress",e=>{"Enter"===e.key&&y()}),c.addEventListener("click",async function(){if(0===n.length&&0===s.length&&0===i.length)return void(g.innerHTML='<div class="text-yellow-400 bg-yellow-900/50 border border-yellow-600 p-4 rounded-md col-span-full text-center">Selecteer ten minste één genre, favoriete film of dienst om suggesties te ontvangen.</div>');p.classList.add("hidden"),m.classList.remove("hidden"),g.innerHTML="";const e=`\n                   Geef op basis van de volgende voorkeuren 6 suggesties voor films of tv-series.\n                    - Stel geen films/series voor die de gebruiker al leuk vindt.\n                    - Indien streamingdiensten worden gespecificeerd, stel dan alleen titels voor die op een van die diensten beschikbaar zijn.\n                    - Geef voor elke suggestie aan op welke streamingdienst deze te vinden is, indien hierom is gevraagd.\n                    \n                    Voorkeuren:\n                    - Favoriete genres: ${n.join(", ")||"Any"}\n                    - Films/series die favoriet zijn: ${s.join(", ")||"None"}\n                    - Available on Streaming Services: ${i.join(", ")||"Any"}\n                    \n                    Provide the response as a JSON array of objects. Each object must have "title", "type" ('Movie' or 'Series'), and "genre" (an array of strings). If a streaming service is relevant, also include a "streamingService" field (e.g., "Netflix", "Prime Video").\n                    Example: [{"title": "Inception", "type": "Movie", "genre": ["Sci-Fi", "Action", "Thriller"], "streamingService": "HBO Max"}]\n                `;try{const n={contents:[{role:"user",parts:[{text:e}]}],generationConfig:{responseMimeType:"application/json",responseSchema:{type:"ARRAY",items:{type:"OBJECT",properties:{title:{type:"STRING"},type:{type:"STRING",enum:["Movie","Series"]},genre:{type:"ARRAY",items:{type:"STRING"}},streamingService:{type:"STRING"}},required:["title","type","genre"]}}}},s="https://generativelanguage.googleapis.com/v1beta/models/gemini-3.0-flash:generateContent?key=",i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)throw new Error(`API request failed with status ${i.status}`);const r=await i.json();if(!(r.candidates&&r.candidates[0].content&&r.candidates[0].content.parts[0]))throw new Error("Invalid response structure from API.");{const e=r.candidates[0].content.parts[0].text;t=JSON.parse(e),g.innerHTML="",t&&0!==t.length?t.forEach(e=>{const t=document.createElement("div");t.className="movie-card bg-gray-700 rounded-lg overflow-hidden shadow-md p-4 flex flex-col";const n="Movie"===e.type?"bg-blue-500":"bg-purple-500",s=e.streamingService?`<span class="text-xs bg-teal-500 text-white px-2 py-1 rounded-full">${e.streamingService}</span>`:"";t.innerHTML=`\n                        <div class="flex-grow">\n                            <h3 class="text-xl font-bold text-white">${e.title}</h3>\n                            <div class="flex items-center justify-between mt-2 mb-3 gap-2">\n                                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full ${n} text-white">\n                                    ${e.type}\n                                </span>\n                                ${s}\n                            </div>\n                            <div class="flex flex-wrap gap-1 mt-2">\n                                ${e.genre.map(e=>`<span class="text-xs bg-gray-600 text-gray-300 px-2 py-1 rounded-full">${e}</span>`).join("")}\n                            </div>\n                        </div>\n                    `,g.appendChild(t)}):g.innerHTML='<div class="text-gray-500 col-span-full text-center py-16">\n                        <h3 class="text-lg font-medium text-gray-400">Geen match gevonden.</h3>\n                        <p class="mt-1 text-sm text-gray-500">Er is geen enkele match of aanbeveling gevonden met deze voorkeuren. Misschien iets minder specifiek?</p>\n                    </div>'}}catch(e){console.error("Error fetching AI suggesties:",e),g.innerHTML='<p class="text-red-400 col-span-full text-center py-16">Sorry, er is een error ontstaan. Het algoritme is bezig. Probeer het nog een keer.</p>'}finally{m.classList.add("hidden")}var t}),function t(){r.innerHTML="",e.forEach(e=>{const s=n.includes(e),i=document.createElement("span");i.textContent=e,i.className="tag cursor-pointer px-3 py-1 rounded-full text-sm font-medium "+(s?"bg-indigo-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),i.addEventListener("click",()=>function(e){const s=n.indexOf(e);s>-1?n.splice(s,1):n.push(e),t()}(e)),r.appendChild(i)})}(),function e(){o.innerHTML="",t.forEach(t=>{const n=i.includes(t),s=document.createElement("span");s.textContent=t,s.className="tag cursor-pointer px-3 py-1 rounded-full text-sm font-medium "+(n?"bg-teal-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),s.addEventListener("click",()=>function(t){const n=i.indexOf(t);n>-1?i.splice(n,1):i.push(t),e()}(t)),o.appendChild(s)})}()});